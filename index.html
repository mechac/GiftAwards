<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ü–æ–¥–∞—Ä–æ–∫ Premium</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--tg-theme-text-color, #000000);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            overflow: hidden;
            /* –§–æ–Ω —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS */
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            background-attachment: fixed;
        }

        .container {
            width: 100%;
            max-width: 350px;
            text-align: center;
            position: relative; /* –î–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞—à–∫–∏ */
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∏–¥–µ–æ */
        .video-container {
            width: 200px;
            height: 200px;
            margin: 0 auto; /* –£–±—Ä–∞–Ω –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .video-container:hover {
            transform: scale(1.05);
        }

        .video-container.animating {
            cursor: not-allowed;
            pointer-events: none;
            transform: scale(1);
        }

        #giftVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∞ */
        .instruction {
            font-size: 14px;
            color: var(--tg-theme-hint-color, #999);
            margin-bottom: 15px;
        }

        /* –ü–ª–∞—à–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ - —Ç–µ–ø–µ—Ä—å –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞ */
        .gift-result {
            display: none;
            position: absolute;
            top: calc(100% + 20px); /* –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–æ–¥ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º —Å –æ—Ç—Å—Ç—É–ø–æ–º */
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 280px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.20);
            animation: fadeInUp 0.5s ease;
        }

        .gift-result.show {
            display: block;
        }

        .gift-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .gift-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 6px;
            /* –¶–≤–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS */
        }

        .gift-text {
            font-size: 14px;
            line-height: 1.4;
            color: var(--tg-theme-text-color, #222);
        }

        .user-name {
            font-weight: 700;
            /* –¶–≤–µ—Ç —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS */
            word-break: break-word;
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, 15px);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(15px); /* –î–æ–±–∞–≤–ª–µ–Ω translateX –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è */
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ */
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            position: absolute;
            animation: confetti-fall 2.5s linear forwards;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="instruction">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–æ–¥–∞—Ä–æ–∫, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å</div>
        
        <div class="video-container" id="videoContainer">
            <video id="giftVideo" muted playsinline preload="auto" poster="gift-preview.jpg">
                <source src="gift-animation.mp4" type="video/mp4">
                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ
            </video>
        </div>

        <!-- –ü–ª–∞—à–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
        <div class="gift-result" id="giftResult">
            <div class="gift-icon">üéÅ</div>
            <div class="gift-title">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</div>
                <div class="gift-text">
                    <span class="user-name" id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>, –≤—ã –≤—ã–∏–≥—Ä–∞–ª–∏
                    <b>Telegram Premium</b> –Ω–∞ 1 –º–µ—Å—è—Ü!
                </div>
            </div>
        </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // ==== –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –§–û–ù ====
        const isDarkTheme = tg.colorScheme === 'dark';
        const bgImage = isDarkTheme ? 'blackfon.jpg' : 'whitefon.jpg';
        document.body.style.backgroundImage = `url(${bgImage})`;
        
        // ==== –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô –¶–í–ï–¢ –¢–ï–ö–°–¢–ê –ü–õ–ê–®–ö–ò ====
        const textColor = isDarkTheme ? '#ffffff' : '#000000';
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.querySelector('.gift-title').style.color = textColor;
        document.querySelector('.user-name').style.color = textColor;
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–∑ —Ç–µ–º—ã
        document.body.style.color = tg.themeParams.text_color || '#000000';

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe.user;
        const userName = user ? `${user.first_name} ${user.last_name || ''}` : '–£–≤–∞–∂–∞–µ–º—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
        document.getElementById('userName').textContent = userName;

        // –†–∞–±–æ—Ç–∞ —Å –≤–∏–¥–µ–æ
        const video = document.getElementById('giftVideo');
        const videoContainer = document.getElementById('videoContainer');
        let isAnimating = false;

        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –ø–æ–∫–∞–∑ –ø–µ—Ä–≤–æ–≥–æ –∫–∞–¥—Ä–∞ –¥–æ –∑–∞–ø—É—Å–∫–∞
        video.addEventListener('loadeddata', () => {
            video.pause();
            video.currentTime = 0;
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
        videoContainer.addEventListener('click', async () => {
            if (isAnimating) {
                console.log('–ê–Ω–∏–º–∞—Ü–∏—è —É–∂–µ –∑–∞–ø—É—â–µ–Ω–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...');
                return;
            }

            isAnimating = true;
            videoContainer.classList.add('animating');

            try {
                // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏–¥–µ–æ —Å –Ω–∞—á–∞–ª–∞
                video.currentTime = 0;
                await video.play();

                // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
                createConfetti();

                // –ñ–¥–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–∏–¥–µ–æ
                await new Promise(resolve => {
                    video.addEventListener('ended', () => {
                        video.pause();
                        video.currentTime = video.duration;
                        resolve();
                    }, { once: true });
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–ª–∞—à–∫—É
                document.getElementById('giftResult').classList.add('show');
                document.querySelector('.instruction').style.display = 'none';

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –±–æ—Ç
                tg.sendData(JSON.stringify({
                    event: 'gift_opened',
                    user_id: user?.id,
                    timestamp: Date.now()
                }));

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                isAnimating = false;
                videoContainer.classList.remove('animating');
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
        function createConfetti() {
            for (let i = 0; i < 40; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.background = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#ff9ff3'][Math.floor(Math.random() * 5)];
                    confetti.style.animationDelay = Math.random() * 1.5 + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 2500);
                }, i * 40);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∏–¥–µ–æ (fallback)
        video.addEventListener('error', (e) => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ:', e);
            document.querySelector('.instruction').textContent = '‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ';
        });
    </script>
</body>
</html>
